

# ⌨️ WuK 开发指令集锦 (Command Cheat Sheet)

## 1. 终端与系统基础 (System & WSL)

**检查网络连通性 (Copilot/Git 报错时用)**
```bash
# 检查是否能穿透到 Windows 代理
curl -v -x http://$(ip route show | grep default | awk '{print $3}'):7890 http://www.google.com
```

**清理后台僵尸进程 (端口被占/重启仿真前必做)**
```bash
killall -9 gz sim_vehicle.py python3 arducopter
```

**查看本机 IP (填 VS Code 设置用)**
```bash
ip route show | grep default | awk '{print $3}'
```

---

## 2. 编译与构建 (Build)

**标准编译 (修改代码后执行)**
```bash
./waf copter
```

**清理并重配置 (编译报错/切换分支时用)**
```bash
./waf distclean
./waf configure --board sitl
```

---

## 3. 启动仿真 (Launch SITL)

**标准启动 (带控制台 + 带地图)**
*适合观察飞行轨迹和位置。*
```bash
# -w: 清除参数缓存 (Wipe EEPROM)
# --add-param-file: 自动加载 WuK 专用参数 (Servo9设置等)
sim_vehicle.py -v ArduCopter --console --map -w
```

**极速启动 (仅控制台)**
*适合快速测试代码逻辑，省资源。*
```bash
sim_vehicle.py -v ArduCopter --console -w
```

---

## 4. 飞行控制 (Flight Control in MAVProxy)

**自动起飞 (悬停 5m)**
```bash
mode guided
arm throttle
takeoff 5
```

**切换操控模式 (LOITER)**
*Loiter 模式下，摇杆回中即悬停，推杆即移动。*
```bash
mode loiter
```

**模拟摇杆控制 (RC Overrides)**
*通道定义：1=Roll(左右), 2=Pitch(前后), 3=Throttle(油门), 4=Yaw(旋转)*
*范围：1000(低) ~ 1500(中) ~ 2000(高)*

```bash
rc 2 1400   # 向前飞 (低头)
rc 2 1600   # 向后飞 (抬头)
rc 1 1400   # 向左移
rc 1 1600   # 向右移
rc 3 1700   # 升高 (Loiter模式下)
rc 3 1300   # 下降 (Loiter模式下)
```

**一键刹车/悬停**
```bash
rc all 1500
```

**自动降落**
```bash
mode land
```

---

## 5. 变构测试 (Morphing Test)

**触发变形 (坠机测试)**
*前提：已加载 wuk.parm 或手动设置了 SERVO9_FUNCTION=59*
```bash
servo set 9 1900
```

**恢复构型 (尝试改出)**
```bash
servo set 9 1100
```

**手动检查参数 (如果变形不动)**
```bash
param show SERVO9_FUNCTION   # 应为 59
param show SERVO9_MIN        # 应为 1000
param show SERVO9_MAX        # 应为 2000
status                       # 查看 servo9_raw 输出值
```

---

## 6. 数据分析与可视化 (Data & Plotting)

**编译日志解析器 (C++)**
*修改了 `tools/wuk_log_parser.cpp` 后执行。*
```bash
g++ tools/wuk_log_parser.cpp -o tools/wuk_log_parser
```

**运行解析 (Parse Log)**
*SITL 的最新日志通常在 `logs/LASTLOG.BIN` 或当前目录下的 `eeprom.bin` 同级目录。*
```bash
# 假设最新日志是 logs/00000001.BIN
./tools/wuk_log_parser logs/00000001.BIN
```
*产出：`wuk_parsed.csv`, `wuk_summary.txt`*

**生成图表 (Generate Plots)**
```bash
python3 tools/wuk_plot.py wuk_parsed.csv
```
*产出：`wuk_tilt.png`, `wuk_thrust_delta.png` 等图片文件。*

---

## 7. 常用快捷宏 (Alias for MAVProxy)

*在 MAVProxy 启动后输入，可简化操作（本次运行有效）：*

```bash
alias add fly "mode guided; arm throttle; takeoff 10"
alias add drop "servo set 9 1900"
alias add recover "servo set 9 1100"
alias add stop "rc all 1500"
```
*使用方法：直接输 `fly` 即可起飞，输 `drop` 即可变构。*
