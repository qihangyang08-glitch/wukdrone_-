

# 📄 WuK 无人机仿真标准操作手册 (SOP)

**版本：** v2.0 (3D Gazebo 版)
**环境：** Windows 11 + WSL2 (Ubuntu 24.04) + Gazebo Harmonic
**前置条件：** 已配置好 `.bashrc` 中的显卡驱动环境变量 (`d3d12`)。

### 一、 启动流程 (Routine Startup)

仿真需要两个终端窗口配合，分别运行 **物理世界 (Gazebo)** 和 **飞控大脑 (SITL)**。

#### 1. 终端 A：启动物理环境 (Gazebo)
负责渲染 3D 画面和计算物理碰撞。
```bash
# -v4: 显示详细日志
# -r: 自动开始运行(Run)，不需要手动点播放键
gz sim -v4 -r iris_runway.sdf
```
*   *成功标志：* 弹出 3D 窗口，看到跑道和飞机，操作流畅不卡顿。

#### 2. 终端 B：启动飞控系统 (SITL)
负责运行 ArduPilot 固件，连接 Gazebo。
```bash
# --model JSON: 强制使用新版通信协议
# --console: 弹出状态控制台
# --map: 弹出地图 (如果显卡压力大可去掉此参数)
cd ~/ardupilot
sim_vehicle.py -v ArduCopter --model JSON --console --map
```
*   *成功标志：* MAVProxy 终端显示 `GPS: 3D Fix`，Gazebo 里的飞机螺旋桨开始转动。

---

### 二、 常用控制指令集 (Command List)

在 **终端 B (MAVProxy)** 中输入以下指令：

#### 1. 起飞流程
```bash
mode guided       # 1. 切入引导模式 (电脑接管)
arm throttle      # 2. 解锁电机
takeoff 5         # 3. 起飞至 5米高度
```

#### 2. 模拟遥控器操作 (RC Override)
用于模拟打杆动作。
*   **通道定义：** 1=横滚(左右), 2=俯仰(前后), 3=油门, 4=偏航(旋转)
*   **数值范围：** 1000(低) ~ 1500(中) ~ 2000(高)
```bash
rc 2 1400         # 低头/前进 (Pitch推杆)
rc 4 1400         # 向左旋转 (Yaw打杆)
rc all 1500       # 所有摇杆回中 (刹车/悬停)
```

#### 3. 变构测试 (WuK 特有)
*前提：已在 SITL 中加载 WuK 物理模型（鸠占鹊巢法）*
```bash
servo set 9 1900  # 触发变形 (假设映射到通道9)
servo set 9 1100  # 恢复构型
```
#### 4.原地垂直降落
```bash
#原地降落
mode land
#一键返航
mode rtl
```


---

### 三、 故障排查 (Troubleshooting)

*   **问题：** Gazebo 很卡。
    *   **解法：** 检查 `glxinfo -B` 是否显示 `D3D12`。如果不显示，重启 WSL (`wsl --shutdown`)。
*   **问题：** 两边没反应，Gazebo 报错 `Magic Number`。
    *   **解法：** 确保 SITL 启动命令里加了 `--model JSON`。
*   **问题：** 飞机一直转圈停不下来。
    *   **解法：** 输入 `rc 4 1500` 回中。

